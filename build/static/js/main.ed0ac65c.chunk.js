(this["webpackJsonpGin-Rummy"]=this["webpackJsonpGin-Rummy"]||[]).push([[0],{24:function(e,t,a){e.exports=a(42)},28:function(e,t,a){},29:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){"use strict";a.r(t);var n=a(3),c=a(0),s=a.n(c),r=a(14),i=a.n(r),l=a(6),u=a(2),o=(a(28),a(29),a(1)),d=(a(13),s.a.createContext({})),h=(a(37),function(e){var t=e.card,a=e.isFaceUp,r=e.player,i=e.isKnock,l=void 0!==i&&i,h=e.pile,f=Object(u.f)(),m=Object(c.useState)(!1),p=Object(n.a)(m,2),v=p[0],b=p[1],O=Object(c.useContext)(d),j=O.discardPile,g=O.setDiscardPile,E=O.deck,y=O.setDeck,k=O.gameState,w=O.setGameState,M=O.currentCard,S=O.setCurrentCard,P=O.players;O.setPlayers;Object(c.useEffect)((function(){b(a)}),[]);var D=function(){0==P[0].calcDeadwood()&&(P[0].score+=25+P[1].calcDeadwood(),P[0].score>=100?(alert("You won by going Gin"),f.push("/")):(alert("You went Gin and gained ".concat(25+P[1].calcDeadwood()," points")),f.push("/chat"))),0==P[1].calcDeadwood()&&(P[1].score+=25+P[0].calcDeadwood(),P[1].score>=100?(alert("".concat(P[1].name," went Gin and won")),f.push("/")):(alert("".concat(P[1].name," went Gin and gained ").concat(25+P[0].calcDeadwood()," points")),f.push("/chat")))};return s.a.createElement(s.a.Fragment,null,t&&s.a.createElement("div",{className:"Card",onClick:function(e){return v?function(e){if(D(),null==r&&"draw"==k){e.preventDefault(),P[0].hand.push(t);var a=Object(o.a)(j);a.shift(),g(a),P[0].calcDeadwood(),w("discard")}if(r===P[0]&&"discard"==k)if(e.preventDefault(),P[0].calcDeadwood()>10){var n=Object(o.a)(j);n.unshift(t),g(n),P[0].hand.splice(P[0].hand.indexOf(t),1),w("opponent")}else if(P[0].calcDeadwood()-(t.value<11?t.value:10)===0){var c=Object(o.a)(j);c.unshift(t),g(c),P[0].hand.splice(P[0].hand.indexOf(t),1),D()}else w("knock-discard"),S(t);if("discard"==h.name&&"knock-discard"==k){var s=Object(o.a)(j);s.unshift(M),g(s),P[0].hand.splice(P[0].hand.indexOf(M),1),w("opponent")}}(e):function(e){if(D(),null==r&&"draw"==k){e.preventDefault(),P[0].hand.push(t);var a=Object(o.a)(E);if(a.splice(a.indexOf(t),1),E.length<1){var n=Object(o.a)(j),c=n;n=[n[0]],c.forEach((function(e,t){e==n[0]&&c.splice(t,1)})),g(n)}y(a),w("discard")}if(l&&"knock-discard"==k){P[1].calcDeadwood(),P[0].possibleMelds.map((function(e){3==e.length&&P[1].deadwoodCards.map((function(t,a){e[0].value==e[1].value!=t.value&&(e[0].suit==e[1].suit!=t.suit||t.value!=e[0].value-1&&t.value!=e[2].value+1)||P[1].deadwoodCards.splice(a,1)}))}));var s=0;P[1].deadwoodCards.map((function(e){s+=e.value<11?e.value:10})),P[0].score+=s-P[0].calcDeadwood(),P[0].score>=100?(alert("You won by knocking!"),f.push("/")):(alert("You knocked and ".concat(s-P[0].calcDeadwood()>-1?"gained":"lost"," ").concat(Math.abs(s-P[0].calcDeadwood())," points")),f.push("/chat"))}}(e)},style:{backgroundImage:l?"url('".concat(".","/card-images/knock.png')"):'url("'.concat("."+"/card-images/".concat(v?function(e){var t;switch(e.value){case 1:t="A";break;case 11:t="J";break;case 12:t="Q";break;case 13:t="K";break;default:t=e.value}return"".concat(t).concat(e.suit[0].toUpperCase(),".png")}(t):"purple_back.png"),'")')}}))}),f=a(7),m=function e(t,a){Object(f.a)(this,e),this.suit=null,this.value=0,this.suit=t,this.value=a},p={HEARTS:"hearts",CLUBS:"clubs",SPADES:"spades",DIAMONDS:"diamonds"},v=a(22),b=function(){function e(t){Object(f.a)(this,e),this.name="",this.score=0,this.hand=[],this.possibleMelds=[],this.bestMelds=[],this.discardPile=[],this.deck=[],this.deadwoodCards=[],this.deadwood=0,this.name=t}return Object(v.a)(e,[{key:"highestValueMeld",value:function(){var e=this,t=null,a=[];return this.possibleMelds.map((function(n,c,s){var r=n,i=!1,l=0;e.possibleMelds.map((function(e,t,n){c!=t&&e.map((function(e,t){a.push(e),r.includes(e)&&(i=!0)}))})),n.map((function(e,t){a.includes(e)||(l+=e.value<11?e.value:10)})),i||(l+=1e3),l>=0&&(t=n)})),t}},{key:"highestValueMeld2",value:function(){var e=this,t=0,a=0,n=[],c=[];return this.possibleMelds.map((function(s,r,i){var l=0;s.map((function(e){var t=!1;n.map((function(a){a.card.value==e.value&&a.card.suit==e.suit&&(t=!0)})),t?n.map((function(t){t.card.value==e.value&&t.card.suit==e.suit&&t.count++})):n.push({card:e,count:1}),l+=e.value<11?e.value:10})),n.map((function(e){e.count>1&&c.push(e.card)}));var u=s.filter((function(e){return c.includes(e)})),o=l/(u.length>0?u.length:1);o>t?(t=o,a=r):o==t&&e.bestMelds.push(s)})),this.possibleMelds[a]}},{key:"checkHandForSets",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;this.possibleMelds=[];var a=Object(o.a)(this.hand),n=a.filter((function(e){return"hearts"==e.suit})),c=a.filter((function(e){return"diamonds"==e.suit})),s=a.filter((function(e){return"clubs"==e.suit})),r=a.filter((function(e){return"spades"==e.suit}));n.sort((function(e,t){return e.value-t.value})),c.sort((function(e,t){return e.value-t.value})),s.sort((function(e,t){return e.value-t.value})),r.sort((function(e,t){return e.value-t.value})),a=[].concat(Object(o.a)(n),Object(o.a)(c),Object(o.a)(s),Object(o.a)(r));for(var i=function(a){var n=[],c=0;e.hand.map((function(e){e.value==a&&(n.push(e),c++)})),c>=t&&e.possibleMelds.push(n)},l=1;l<14;l++)i(l);var u=0,d=[];a.map((function(n,c,s){if(c!=a.length-1){var r=s[c+1];r.value==n.value+1&&r.suit==n.suit?(u++,d.push(n),c==a.length-2&&u>=3&&(d.push(r),d.length>0&&e.possibleMelds.push(d))):(u>=t&&(d.push(n),d.length>0&&e.possibleMelds.push(d)),u=0,d=[])}}))}},{key:"filterMelds",value:function(){var e=this.highestValueMeld();this.bestMelds.push(e);var t=Object(o.a)(this.possibleMelds);t.map((function(a,n){e.map((function(e){a.includes(e)&&t.splice(n,1)}))})),this.possibleMelds=t}},{key:"getMelds",value:function(){for(this.bestMelds=[],this.checkHandForSets();this.possibleMelds.length>0;)this.filterMelds()}},{key:"calcDeadwood",value:function(){var e=this;this.deadwoodCards=[],this.getMelds();var t=0;return this.hand.map((function(a){var n=!1;e.bestMelds.map((function(e){e.includes(a)&&(n=!0)})),n||(t+=a.value<11?a.value:10,e.deadwoodCards.push(a))})),this.deadwood=t,t}},{key:"arrDiff",value:function(e,t){for(var a=[],n=[],c=0;c<e.length;c++)a[e[c]]=!0;for(c=0;c<t.length;c++)a[t[c]]?delete a[t[c]]:a[t[c]]=!0;for(var s in a)n.push(s);return n}},{key:"opponentTurn",value:function(){var e=this;if(this.getMelds(),0==this.calcDeadwood());else{this.checkHandForSets(2);var t,a,n=Object(o.a)(this.hand),c=this.discardPile[0];this.hand.push(c);var s=Object(o.a)(this.discardPile);s.splice(s.indexOf(c),1),this.getMelds(),t=this.possibleMelds.length,this.hand=Object(o.a)(n);var r=this.deck[0];this.hand.push(r);var i=Object(o.a)(this.deck);if(i.splice(i.indexOf(r),1),this.getMelds(),a=this.possibleMelds.length,this.hand=Object(o.a)(n),t>a){var l=this.discardPile[0];this.hand.push(l);var u=Object(o.a)(this.discardPile);u.splice(u.indexOf(l),1),this.discardPile=Object(o.a)(u)}else if(a>t){var d=this.deck[0];this.hand.push(d);var h=Object(o.a)(this.deck);h.splice(h.indexOf(d),1),this.deck=Object(o.a)(h)}else if(this.deck[0].value>this.discardPile[0].value){var f=this.discardPile[0];this.hand.push(f);var m=Object(o.a)(this.discardPile);m.splice(m.indexOf(f),1),this.discardPile=Object(o.a)(m)}else{var p=this.deck[0];this.hand.push(p);var v=Object(o.a)(this.deck);v.splice(v.indexOf(p),1),this.deck=Object(o.a)(v)}this.getMelds();var b,O,j,g=Object(o.a)(this.hand).filter((function(t){return!e.possibleMelds.flat().includes(t)})),E=0;g.forEach((function(e){e.value>E&&(E=e.value,b=e)})),this.hand.forEach((function(e,t){e.value==b.value&&e.suit==b.suit&&(O=t,j=e)})),this.discardPile.unshift(j),this.hand.splice(O,1)}return"draw"}}]),e}(),O=(a(38),a(39),function(){var e=Object(u.f)(),t=Object(c.useContext)(d),a=t.playerName,n=t.setPlayerName,r=(t.players,t.setPlayers),i=t.isFindingGame,l=t.setIsFindingGame;return s.a.createElement("div",{className:"Lobby"},s.a.createElement("h1",null,"Online Gin-Rummy"),i?s.a.createElement("h2",{className:"loading"},"Searching..."):s.a.createElement("form",{onSubmit:function(t){return function(t){t.preventDefault(),n(a),r([new b(a),new b("Player 2")]),l(!0);var c=1e3*Math.floor(1*Math.random());setTimeout((function(){e.push("/chat")}),c)}(t)},className:"nameForm"},s.a.createElement("label",{htmlFor:"name"},"Enter your name"),s.a.createElement("input",{type:"text",name:"name",id:"nameField",placeholder:"Name",value:a,onChange:function(e){n(e.target.value)}}),s.a.createElement("input",{type:"submit",value:"Find Game"})))}),j=function(){var e=Object(u.f)(),t=Object(c.useState)([]),a=Object(n.a)(t,2),r=a[0],i=a[1],l=Object(c.useState)([]),f=Object(n.a)(l,2),v=f[0],b=f[1],O=Object(c.useState)(!1),j=Object(n.a)(O,2),g=j[0],E=j[1],y=Object(c.useContext)(d),k=y.gameState,w=y._setGameState,M=y.prevGameState,S=y.setPrevGameState,P=(y.playerName,y.setPlayerName,y.players),D=y.setPlayers,N=Object(c.useState)(),x=Object(n.a)(N,2),C=x[0],G=x[1],F=function(e){S(k),w(e)},T=Object(c.useRef)();return Object(c.useEffect)((function(){void 0!==P[1]?P.forEach((function(e){e.hand=[]})):e.push("/"),function(){var e=[];Object.keys(p).map((function(t){for(var a=1;a<14;a++){var n=new m(t,a);e.push(n)}})),i(e)}(),setTimeout((function(){T&&T.current.click()}),100)}),[]),Object(c.useEffect)((function(){"opponent"==M&&(i(Object(o.a)(P[1].deck)),b(Object(o.a)(P[1].discardPile))),"opponent"==k&&setTimeout((function(){F(P[1].opponentTurn())}),Math.floor(3e3*Math.random())+1e3)}),[k]),Object(c.useEffect)((function(){P.forEach((function(e){e.discardPile=Object(o.a)(v),e.deck=Object(o.a)(r)}))}),[v,r]),Object(c.useEffect)((function(){if(r.length<1&&"opponent"==k){var e=Object(o.a)(v),t=e;e=[e[0]],t.forEach((function(a,n){a==e[0]&&t.splice(n,1)})),i(t),b(e)}}),[r,v]),s.a.createElement(d.Provider,{value:{discardPile:v,setDiscardPile:b,deck:r,setDeck:i,userPlayer:P[0],gameState:k,setGameState:F,currentCard:C,setCurrentCard:G,players:P,setPlayers:D}},s.a.createElement("div",{className:"Home"},!g&&s.a.createElement("button",{onClick:function(e){e.preventDefault(),E(!0),function(){for(var e=!0;e;){for(var t=Object(o.a)(r),a=0;a<20;a++){for(var n=Object(o.a)(t),c=Math.floor(Math.random()*n.length-1);-1==c;)c=Math.floor(Math.random()*n.length-1);var s=n[c];P[a%2].hand.push(s),n.splice(c,1),t=Object(o.a)(n)}i(t.sort((function(){return.5-Math.random()})));for(var l=Object(o.a)(t),u=Math.floor(Math.random()*l.length-1);-1==u;)u=Math.floor(Math.random()*l.length-1);b([l[u]]),l.splice(u,1),t=Object(o.a)(l),i(t.sort((function(){return.5-Math.random()}))),e=!1,t.filter((function(e){return v.includes(e)})).length>=1&&(e=!0),t.filter((function(e){return P[0].hand.includes(e)})).length>=1&&(e=!0),t.filter((function(e){return P[1].hand.includes(e)})).length>=1&&(e=!0),P[0].hand.filter((function(e){return P[1].hand.includes(e)})).length>=1&&(e=!0),v.filter((function(e){return P[0].hand.includes(e)})).length>=1&&(e=!0),v.filter((function(e){return P[1].hand.includes(e)})).length>=1&&(e=!0)}F("draw")}()},id:"dealBtn",ref:T},"Loading"),P[1]&&s.a.createElement("h2",null,P[1].name," Score: ",P[1].score),s.a.createElement("div",{className:"cardList"},P[1]&&P[1].hand.map((function(e,t){return s.a.createElement(h,{card:e,isFaceUp:!1,player:P[1],pile:{name:"opponentHand",ref:P[1].hand}})}))),s.a.createElement("br",null),s.a.createElement("div",{className:"middleDeck ".concat("opponent"==k?"greyedOut":"")},s.a.createElement("div",{className:"cardWrapper"},s.a.createElement(h,{card:new m("hearts",null),isFaceUp:!1,player:null,isKnock:!0})),s.a.createElement("div",{className:"cardWrapper"},s.a.createElement(h,{card:r[0],isFaceUp:!1,player:null,pile:{name:"deck",ref:r}})),s.a.createElement("div",{className:"cardWrapper"},s.a.createElement(h,{card:v[0],isFaceUp:!0,player:null,pile:{name:"discard",ref:v}}))),s.a.createElement("br",null),s.a.createElement("div",{className:"cardList ".concat("opponent"==k?"greyedOut":"")},P[0]&&P[0].hand.map((function(e,t){return s.a.createElement(h,{card:e,isFaceUp:!0,player:P[0],pile:{name:"hand",ref:P[0].hand}})}))),s.a.createElement("h2",{className:"gameState"},k?function(e){switch(e){case"draw":return"Draw Card";case"discard":return"Discard";case"opponent":return"".concat(P[1].name,"'s turn");default:return e}}(k):""),P[0]&&s.a.createElement("div",{className:"player1Score"},s.a.createElement("h2",null,P[0].name," Score: ",P[0].score),s.a.createElement("div",{style:{flexGrow:1}}),s.a.createElement("h2",null,"Deadwood: ",P[0].calcDeadwood(),"/10"))))},g=a(18),E=a.n(g),y=a(23),k=(a(41),function e(t,a,n){Object(f.a)(this,e),this.sender=t,this.score=a,this.text=n,this.timestamp=Date.now()}),w=function(){var e=Object(u.f)(),t=Object(c.useContext)(d),a=t.playerName,r=(t.setPlayerName,t.players),i=(t.setPlayers,t.isFindingGame,t.setIsFindingGame,Object(c.useState)([])),l=Object(n.a)(i,2),h=l[0],f=l[1],m=Object(c.useState)(""),p=Object(n.a)(m,2),v=p[0],b=p[1],O=Object(c.useState)(!0),j=Object(n.a)(O,2);j[0],j[1];Object(c.useEffect)((function(){void 0===r[1]&&e.push("/")}),[]);var g=function(e){for(var t="object"!=typeof e?JSON.parse(e):e,a="playerName, score, messageBody, messageTimestamp, playerScore\r\n",n=0;n<t.length;n++){var c="";for(var s in t[n])""!=c&&(c+=","),c+=t[n][s];a+=c+"\r\n"}return a},w=function(){var e=Object(y.a)(E.a.mark((function e(){var t;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(".","/e.c.stanton/studies/GinRummy/ginrummy.php"),e.next=3,fetch(t,{method:"POST",mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({results2send:g(h)})});case 3:e.sent;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){var t=2,a=0,n=setInterval((function(){if(0==t&&0==a)w(),e.push("/play"),clearInterval(n);else if(document.getElementById("timer").innerHTML="Round starting in ".concat(t," minutes and ").concat(a," seconds"),--a<0&&(t--,a=59),a%10==0){var c=0;void 0!==r&&(c=r[1].score);var s=new k("Fake User",c,"Fake user message");f((function(e){return[].concat(Object(o.a)(e),[s])}))}}),1e3)}),[]),s.a.createElement(d.Provider,{value:{playerName:a}},s.a.createElement("div",{className:"Chat"},s.a.createElement("h1",null,"Online Gin-Rummy"),s.a.createElement("h2",null,"Chat"),s.a.createElement("h2",{id:"timer"},"..."),s.a.createElement("div",{className:"message-area"},s.a.createElement("ul",null,h.map((function(e){return s.a.createElement("div",{className:"message ".concat(e.sender===a?"ownMessage":"")},s.a.createElement("h3",null,e.sender),s.a.createElement("p",null,e.text))}))),s.a.createElement("div",{className:"spacer"}),s.a.createElement("form",{onSubmit:function(e){return function(e){e.preventDefault();var t=0;void 0!==r&&(t=a==r[0].name?r[0].score:r[1].score);var n=new k(a,t,v);f([].concat(Object(o.a)(h),[n])),b("")}(e)}},s.a.createElement("textarea",{type:"text",name:"message",id:"message-box",placeholder:"Message",value:v,onChange:function(e){return function(e){e.preventDefault(),b(e.target.value)}(e)}}),s.a.createElement("input",{type:"submit",value:"Send",disabled:""===v})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var M=function(){var e=Object(c.useState)(null),t=Object(n.a)(e,2),a=t[0],r=t[1],i=Object(c.useState)(""),o=Object(n.a)(i,2),h=o[0],f=o[1],m=Object(c.useState)("Player 1"),p=Object(n.a)(m,2),v=p[0],b=p[1],g=Object(c.useState)(!1),E=Object(n.a)(g,2),y=E[0],k=E[1],M=Object(c.useState)([]),S=Object(n.a)(M,2),P=S[0],D=S[1];return s.a.createElement(d.Provider,{value:{gameState:a,_setGameState:r,prevGameState:h,setPrevGameState:f,playerName:v,setPlayerName:b,players:P,setPlayers:D,isFindingGame:y,setIsFindingGame:k}},s.a.createElement(l.a,{basename:"/"},s.a.createElement("div",{className:"container"},s.a.createElement(u.c,null,s.a.createElement(u.a,{exact:!0,path:"/"},s.a.createElement(O,null)),s.a.createElement(u.a,{exact:!0,path:"/chat"},s.a.createElement(w,null)),s.a.createElement(u.a,{exact:!0,path:"/play"},s.a.createElement(j,null))))))};i.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[24,1,2]]]);
//# sourceMappingURL=main.ed0ac65c.chunk.js.map